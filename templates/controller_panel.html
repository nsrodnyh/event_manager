{% extends "base.html" %}
{% load static %}
{% block content %}

<!-- ‚ïê‚ïó –ó–∞–≥–æ–ª–æ–≤–æ–∫ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<h2 class="text-2xl md:text-3xl font-semibold flex items-center gap-2 mb-6">
    üé´ –ö–æ–Ω—Ç—Ä–æ–ª—å&nbsp;–ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏:
    <span class="text-indigo-600 dark:text-indigo-400">{{ event.title }}</span>
</h2>
<p class="mb-10">
    <span class="font-medium">–î–∞—Ç–∞:</span>
    {{ event.date|date:"j E Y ¬∑ H:i" }}
</p>

<!-- ‚ïê‚ïó –°–µ—Ç–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {% for reg in registrations %}
        <div class="bg-white dark:bg-[#262626] rounded-2xl shadow p-6 flex flex-col h-full">
            <h3 class="text-lg font-medium mb-1">{{ reg.full_name }}</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">{{ reg.phone }}</p>
            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">{{ reg.email }}</p>

            <!-- Toggle -->
            <div class="mt-auto flex items-center gap-3">
                <input  id="reg-{{ reg.id }}"
                        type="checkbox"
                        {% if reg.checked_in %}checked{% endif %}
                        class="h-5 w-10 appearance-none rounded-full
                               bg-gray-300 dark:bg-gray-600
                               peer transition
                               checked:bg-teal-500 relative
                               before:absolute before:top-0.5 before:left-0.5
                               before:h-4 before:w-4 before:rounded-full
                               before:bg-white before:transition
                               peer-checked:before:translate-x-5"
                        onclick="toggleCheckin(this,'{% url 'toggle_checkin' event.id reg.id %}')">

                <label for="reg-{{ reg.id }}" class="select-none text-sm">
                    {% if reg.checked_in %}
                        ‚úÖ –û—Ç–º–µ—Ç–∫–∞: –ü—Ä–∏—à—ë–ª
                    {% else %}
                        ‚ùå –ù–µ&nbsp;–ø—Ä–∏—à—ë–ª
                    {% endif %}
                </label>
            </div>
        </div>
    {% empty %}
        <p class="text-gray-500 dark:text-gray-400">–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>
    {% endfor %}
</div>

<!-- ‚ïê‚ïó –í—ã—Ö–æ–¥ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<form method="post" action="{% url 'logout' %}" class="mt-10">
    {% csrf_token %}
    <button type="submit"
            class="inline-flex items-center gap-2 px-5 py-2 rounded-full
                   border border-gray-300 dark:border-gray-600
                   text-gray-700 dark:text-gray-200
                   hover:bg-gray-100 dark:hover:bg-gray-700/60
                   hover:-translate-y-0.5 active:translate-y-0
                   shadow-sm hover:shadow transition text-sm font-medium">
        üö™ <span>–í—ã–π—Ç–∏</span>
    </button>
</form>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê JS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<script>
  /* simple csrf from cookie */
  function getCookie(name){
      const v=document.cookie.split('; ').find(row=>row.startsWith(name+'='));
      return v?decodeURIComponent(v.split('=')[1]):null;
  }
  const csrftoken = getCookie('csrftoken');

  function toggleCheckin(checkbox, url){
      fetch(url,{
          method:'POST',
          credentials:'same-origin',
          headers:{
              'X-CSRFToken': csrftoken,
              'X-Requested-With': 'XMLHttpRequest'
          }
      })
      .then(r=>{
          if(!r.ok) throw new Error();
          return r.json();
      })
      .then(data=>{
          const label = checkbox.parentElement.querySelector('label');
          label.textContent = data.checked ? '‚úÖ –û—Ç–º–µ—Ç–∫–∞: –ü—Ä–∏—à—ë–ª'
                                           : '‚ùå –ù–µ –ø—Ä–∏—à—ë–ª';
      })
      .catch(()=>{
          checkbox.checked = !checkbox.checked;
          alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–º–µ—Ç–∫—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.');
      });
  }
</script>

{% endblock %}
