{% extends 'base.html' %}
{% block content %}

    <h2 class="mb-3">üé´ –í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ: {{ registration.event.title }}</h2>

    <p><strong>–§–ò–û:</strong> {{ registration.full_name }}</p>
    <p><strong>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞:</strong> {{ registration.email }}</p>
    <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ registration.phone }}</p>

    <hr>

    <h4>üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h4>
    {% if schedule %}
        <ul class="list-group mb-4">
            {% for item in schedule %}
                <li class="list-group-item">
                    <strong>{{ item.title }}</strong><br>
                    {{ item.start_time|time:"H:i" }}‚Äì{{ item.end_time|time:"H:i" }}<br>
                    {{ item.description|default:"" }}

                    {% if item.materials.exists %}
                        <div class="mt-2">
                            <strong>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</strong>
                            <ul class="mb-0">
                                {% for m in item.materials.all %}
                                    <li><a href="{{ m.file.url }}">{{ m.description }}</a></li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}

                    {# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –æ—Ç–∑—ã–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ #}
                    {% if item.feedback %}
                        <div class="mt-2">
                            <span class="text-warning">
                                {% for _ in "12345"|make_list %}
                                    {% if forloop.counter <= item.feedback.rating %}‚òÖ{% else %}‚òÜ{% endif %}
                                {% endfor %}
                            </span>
                            <p class="mb-1">{{ item.feedback.text|default:"‚Äî"|linebreaksbr }}</p>
{#                            <small class="text-muted">#}
{#                                {{ item.feedback.created_at|localtime|date:"d.m.Y H:i" }}#}
{#                            </small>#}
                        </div>

                    {% elif item.end_time <= now %}
                        <a href="{% url 'leave_activity_feedback' access_token=registration.access_token activity_id=item.id %}"
                           class="btn btn-outline-secondary btn-sm mt-2">üìù –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –µ—â—ë –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.</p>
    {% endif %}

    <hr>

    <h4>üìÇ –û–±—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h4>
    {% if materials %}
        <ul>
            {% for m in materials %}
                <li><a href="{{ m.file.url }}">{{ m.description }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.</p>
    {% endif %}

    {% load tz %}
    {% timezone "Europe/Moscow" %}
        {% now "UTC" as now %}
    {% endtimezone %}

    {% if feedback %}
        <h4>üìë –í–∞—à –æ—Ç–∑—ã–≤</h4>
        <div class="mb-2 text-warning">
            {% for _ in "12345"|make_list %}
                {% if forloop.counter <= feedback.rating %}‚òÖ{% else %}‚òÜ{% endif %}
            {% endfor %}
        </div>
        <p>{{ feedback.text|default:"‚Äî"|linebreaksbr }}</p>
        <small class="text-muted">
            –û—Å—Ç–∞–≤–ª–µ–Ω {{ feedback.created_at|localtime|date:"d.m.Y H:i" }}
        </small>
    {% elif can_leave_feedback %}
        <a href="{% url 'leave_feedback_token' registration.access_token %}" class="btn btn-outline-success mt-4">
            üìù –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</a>
    {% else %}
        <p class="text-muted mt-4 fst-italic">
            –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ {{ event.end_date|date:"j E Y –≤ H:i" }}
        </p>
    {% endif %}

{% endblock %}
