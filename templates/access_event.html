{% extends "base.html" %}
{% load tz %}
{% block content %}

<!-- ‚ïê‚ïó –ó–∞–≥–æ–ª–æ–≤–æ–∫ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<h2 class="text-2xl md:text-3xl font-semibold flex items-center gap-2 mb-8">
    üé´ –í—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞&nbsp;–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ:
    <span class="text-indigo-600 dark:text-indigo-400">{{ registration.event.title }}</span>
</h2>

<!-- ‚ïê‚ïó –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="bg-white dark:bg-[#262626] rounded-2xl shadow p-6 mb-12">
    <p><span class="font-medium w-40 text-gray-600 dark:text-gray-400">–§–ò–û:</span> {{ registration.full_name }}</p>
    <p><span class="font-medium w-40 text-gray-600 dark:text-gray-400">E-mail:</span> {{ registration.email }}</p>
    <p><span class="font-medium w-40 text-gray-600 dark:text-gray-400">–¢–µ–ª–µ—Ñ–æ–Ω:</span> {{ registration.phone }}</p>
</section>

<!-- ‚ïê‚ïó –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<h3 class="text-xl font-semibold mb-6">üìë –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>

{% if schedule %}
    <div class="space-y-6 mb-14">
    {% for item in schedule %}
        <div class="bg-white dark:bg-[#262626] rounded-2xl shadow p-6">
            <h4 class="font-medium text-lg">{{ item.title }}</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400">
                {{ item.start_time|time:"H:i" }}‚Äì{{ item.end_time|time:"H:i" }}
            </p>
            {% if item.description %}
                <p class="mt-1">{{ item.description }}</p>
            {% endif %}

            {% if item.materials.exists %}
                <div class="mt-4">
                    <h5 class="font-medium mb-1">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</h5>
                    <ul class="list-disc list-inside space-y-1">
                        {% for m in item.materials.all %}
                            <li>
                                <a href="{{ m.file.url }}" class="text-indigo-600 dark:text-indigo-400 underline">
                                    {{ m.description }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            {# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –û—Ç–∑—ã–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ #}
            {% if item.feedback %}
                <div class="mt-4">
                    <span class="text-warning">
                        {% for _ in "12345"|make_list %}
                            {% if forloop.counter <= item.feedback.rating %}‚òÖ{% else %}‚òÜ{% endif %}
                        {% endfor %}
                    </span>
                    <p class="mt-1">{{ item.feedback.text|default:"‚Äî"|linebreaksbr }}</p>
                </div>
            {% elif item.end_time <= now %}
                <a href="{% url 'leave_activity_feedback' access_token=registration.access_token activity_id=item.id %}"
                   class="inline-flex items-center gap-2 px-4 py-2 rounded-full
                          bg-gray-800/90 text-gray-100 hover:bg-gray-900
                          hover:-translate-y-0.5 active:translate-y-0
                          shadow hover:shadow-lg transition font-medium text-sm mt-4">
                    üìù <span>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤</span>
                </a>
            {% endif %}
        </div>
    {% endfor %}
    </div>
{% else %}
    <p class="text-gray-500 mb-14">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –µ—â—ë –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ.</p>
{% endif %}

<!-- ‚ïê‚ïó –û–±—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<h3 class="text-xl font-semibold mb-6">üìÇ –û–±—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>

{% if materials %}
    <ul class="list-disc list-inside space-y-1 mb-14">
        {% for m in materials %}
            <li>
                <a href="{{ m.file.url }}"
                   class="text-indigo-600 dark:text-indigo-400 underline">{{ m.description }}</a>
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p class="text-gray-500 mb-14">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.</p>
{% endif %}

<!-- ‚ïê‚ïó –û—Ç–∑—ã–≤ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
{% timezone "Europe/Moscow" %}{% now "UTC" as now %}{% endtimezone %}

{% if feedback %}
    <h3 class="text-xl font-semibold mb-4">üìë –í–∞—à –æ—Ç–∑—ã–≤</h3>

    <div class="bg-white dark:bg-[#262626] rounded-2xl shadow p-6 mb-12">
        <div class="mb-2 text-warning">
            {% for _ in "12345"|make_list %}
                {% if forloop.counter <= feedback.rating %}‚òÖ{% else %}‚òÜ{% endif %}
            {% endfor %}
        </div>
        <p class="mb-2">{{ feedback.text|default:"‚Äî"|linebreaksbr }}</p>
        <small class="text-xs text-gray-500">
            –û—Å—Ç–∞–≤–ª–µ–Ω {{ feedback.created_at|localtime|date:"d.m.Y H:i" }}
        </small>
    </div>

{% elif can_leave_feedback %}
    <a href="{% url 'leave_feedback_token' registration.access_token %}"
       class="inline-flex items-center gap-2 px-5 py-2 rounded-full
              bg-indigo-600 text-white hover:bg-indigo-700
              hover:-translate-y-0.5 active:translate-y-0
              shadow hover:shadow-lg transition font-medium text-sm">
        üìù <span>–û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –æ&nbsp;–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏</span>
    </a>
{% else %}
    <p class="text-gray-500 mt-6">
        –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ—Å–ª–µ {{ event.end_date|date:"j E Y –≤ H:i" }}.
    </p>
{% endif %}

{% endblock %}
